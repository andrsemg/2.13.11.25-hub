##############################################################
# ‚è∞ –ë–£–î–ò–õ–¨–ù–ò–ö–ò
##############################################################
- id: '1758485977699'
  alias: –ë—É–¥–∏–ª—å–Ω–∏–∫ 5:50 (—É—Ç—Ä–æ, –µ—Å–ª–∏ –¥–æ–º–∞)
  trigger:
    - platform: time
      at: "05:50:00"
  condition:
    - condition: sun
      after: sunrise
      before: sunset
    - condition: zone
      entity_id: person.pilot
      zone: zone.zona_doma
  action:
    - service: scene.turn_on
      target:
        entity_id: scene.outside_light
  mode: single

##############################################################
# üè† –ü–†–ò–°–£–¢–°–¢–í–ò–ï
##############################################################
- id: '1758565181246'
  alias: –õ—é–¥–∞ –Ω–µ –¥–æ–º–∞
  description: –ö–æ–≥–¥–∞ –õ—é–¥–∞ –≤—ã—Ö–æ–¥–∏—Ç –∏–∑ –¥–æ–º–∞
  use_blueprint:
    path: homeassistant/notify_leaving_zone.yaml
    input:
      person_entity: person.lydmila
      zone_entity: zone.zona_doma
      notify_device: 61dadb1c71ea3f1f584778bcf7887979

##############################################################
# üì∏ –ö–ê–ú–ï–†–´ –ò –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø
##############################################################
- id: '1758828162807'
  alias: –§–æ—Ç–æ –∫–∞–ª–∏—Ç–∫–∏ –≤ Telegram
  trigger:
    # –∏—Å—Ö–æ–¥–Ω—ã–π —Ç—Ä–∏–≥–≥–µ—Ä –±—ã–ª device-change; –∑–∞–º–µ–Ω–∏–ª –Ω–∞ state-—Ç—Ä–∏–≥–≥–µ—Ä –¥–ª—è switch-entity
    - platform: state
      entity_id: switch.ebb0e68cf97d1d4f4ec9b27321928471
  action:
    - service: script.outside_camera_snapshot_send
    - delay: "00:00:05"
    - service: notify.telegram
      data:
        message: "–§–æ—Ç–æ –∫–∞–ª–∏—Ç–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ üì∑"
  mode: single

- id: '1759568984689'
  alias: –§–æ—Ç–æ –ø—Ä–∏—Ö–æ–∂–µ–π –≤ Telegram
  trigger:
    - platform: state
      entity_id: sensor.mi_6525865227_message
  condition:
    - condition: template
      value_template: "{{ '–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ –¥–≤–∏–∂–µ–Ω–∏–µ' in trigger.to_state.state }}"
  action:
    - service: script.hallway_camera_snapshot_send
    - delay: "00:00:05"
    - service: notify.telegram
      data:
        message: "üì∏ –§–æ—Ç–æ –∏–∑ –ø—Ä–∏—Ö–æ–∂–µ–π –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ"
  mode: single

- id: '1761435419954'
  alias: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —Å—Ç–∞—Ç—É—Å–µ —Å–≤–µ—Ç–∞ –Ω–∞ —É–ª–∏—Ü–µ
  trigger:
    # –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ: –∑–∞–º–µ–Ω–∏–ª device-—Ç—Ä–∏–≥–≥–µ—Ä –Ω–∞ state-—Ç—Ä–∏–≥–≥–µ—Ä –¥–ª—è switch-entity
    - platform: state
      entity_id: switch.c0e2dbf9bfc9b4acbf9c79057b25fcb1
  action:
    - service: notify.telegram
      data:
        message: "üí° –°–≤–µ—Ç –Ω–∞ —É–ª–∏—Ü–µ –≤—ã–∫–ª—é—á–µ–Ω/–≤–∫–ª—é—á–µ–Ω"
  mode: single

##############################################################
# ü§ñ –ì–û–õ–û–°–û–í–´–ï –ö–û–ú–ê–ù–î–´ (WYOMING + GEMINI)
##############################################################
- id: 'wyoming_voice_processing'
  alias: –û–±—Ä–∞–±–æ—Ç–∫–∞ –≥–æ–ª–æ—Å–æ–≤—ã—Ö –∫–æ–º–∞–Ω–¥ —á–µ—Ä–µ–∑ Wyoming
  trigger:
    - platform: event
      event_type: assist_pipeline.run
  action:
    - service: script.process_voice_command
      data:
        question: "{{ trigger.event.data.text }}"
  mode: single

- id: 'wyoming_voice_logging'
  alias: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≥–æ–ª–æ—Å–æ–≤—ã—Ö –∫–æ–º–∞–Ω–¥
  trigger:
    - platform: event
      event_type: assist_pipeline.run
  action:
    - service: persistent_notification.create
      data:
        title: "–ì–æ–ª–æ—Å–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞"
        message: "–ü–æ–ª—É—á–µ–Ω–æ: {{ trigger.event.data.text }}"
        notification_id: "voice_command_log"
  mode: single

- id: '1759561522769'
  alias: Telegram Gemini Assistant
  description: –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π Telegram —á–µ—Ä–µ–∑ Gemini AI
  trigger:
    - platform: event
      event_type: telegram_message
  variables:
    user_text: "{{ trigger.event.data.text | default('') }}"
  action:
    - choose:
        - conditions:
            - condition: template
              value_template: "{{ user_text == '/start' }}"
          sequence:
            - service: notify.telegram
              data:
                message: "–ü—Ä–∏–≤–µ—Ç! –Ø –≤–∞—à AI-–ø–æ–º–æ—â–Ω–∏–∫ ü§ñ –ó–∞–¥–∞–≤–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å—ã!"
        - conditions:
            - condition: template
              value_template: "{{ user_text not in ['', '/start'] }}"
          sequence:
            - service: conversation.process
              data:
                text: "{{ user_text }}"
            - delay: "00:00:03"
            - service: notify.telegram
              data:
                message: "{{ states('conversation.last_response') | default('–ù–µ—Ç –æ—Ç–≤–µ—Ç–∞ –æ—Ç AI üòï') }}"
  mode: single

##############################################################
# üß© –û–¢–õ–ê–î–ö–ê
##############################################################
- id: 'debug_telegram_events'
  alias: Debug Telegram Events
  description: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö Telegram-—Å–æ–±—ã—Ç–∏–π –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
  trigger:
    - platform: event
      event_type: telegram_message
  action:
    - service: persistent_notification.create
      data:
        title: "Telegram Event Debug"
        message: |
          –ü–æ–ª–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ:
          {{ trigger }}
          ---
          –¢–µ–∫—Å—Ç: {{ trigger.data.text | default('NO_TEXT') }}
          Chat ID: {{ trigger.data.chat_id | default('NO_CHAT_ID') }}
  mode: single
