

#id: '1758754102235'
#alias: –§–æ—Ç–æ –∫–∞–ª–∏—Ç–∫–∏ –≤ —Ç–µ–ª–µ–≥—Ä–∞–º
#description: '–î–µ–ª–∞–µ—Ç —Å–Ω–∏–º–æ–∫ –∫–∞–ª–∏—Ç–∫–∏ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ Telegram'
#triggers:
 # - platform: state
  #  entity_id: switch.sonoff_10025bf30f_1  # –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –ø–æ–Ω—è—Ç–Ω–æ–µ –∏–º—è
#conditions: []
#actions:
 # - action: camera.snapshot
  #  data:
   #   filename: /config/camera_photos/kalitka_{{ now().strftime('%Y%m%d_%H%M%S') }}.jpg
   # target:
    #  entity_id: camera.192_168_0_112
 # - delay: '00:00:03'  # –î–∞–µ–º –≤—Ä–µ–º—è –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ —Å–Ω–∏–º–∫–∞
#  - action: telegram_bot.send_photo
 #   data:
  #    caption: 'üì∏ –°–Ω–∏–º–æ–∫ –∫–∞–ª–∏—Ç–∫–∏ {{ now().strftime("%d.%m.%Y %H:%M:%S") }}'
   #   file: /config/camera_photos/kalitka_{{ now().strftime('%Y%m%d_%H%M%S') }}.jpg
    #  chat_id: 813740593
#mode: single

# –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª –Ω–∞ —Ö–æ—Å—Ç
docker cp home-assistant:/config/configuration.yaml ./configuration.yaml

# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª
nano configuration.yaml

# –í–µ—Ä–Ω—É—Ç—å —Ñ–∞–π–ª –æ–±—Ä–∞—Ç–Ω–æ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker cp ./configuration.yaml home-assistant:/config/configuration.yaml



-------------------
docker rm wyoming-vosk
wyoming-vosk
wyoming-vosk
pi@raspberrypi:~/vosk-model-small-ru-0.22$ docker run -d \
  --name wyoming-vosk \
  --restart=unless-stopped \
  -p 10300:10300 \
  -v /home/pi/vosk-model-small-ru-0.22:/model \
  rhasspy/wyoming-vosk \
  --data-dir /model
0b0c06385ebd0f9521ae5cb2a26fb4b722120267484d1f1a4a54e743563a4b7b
pi@raspberrypi:~/vosk-model-small-ru-0.22$ # –ü—Ä–æ–≤–µ—Ä–∏–º —Å—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker ps | grep wyoming-vosk

# –ü—Ä–æ–≤–µ—Ä–∏–º –ª–æ–≥–∏
docker logs wyoming-vosk

# –ü—Ä–æ–≤–µ—Ä–∏–º, —Å–ª—É—à–∞–µ—Ç –ª–∏ –ø–æ—Ä—Ç
netstat -tlnp | grep 10300
0b0c06385ebd   rhasspy/wyoming-vosk                           "bash /run.sh --data‚Ä¶"   42 seconds ago   Up 41 seconds   0.0.0.0:10300->10300/tcp, :::10300->10300/tcp   wyoming-vosk
INFO:root:Ready
(Not all processes could be identified, non-owned process info
 will not be shown, you would have to be root to see it all.)
tcp        0      0 0.0.0.0:10300           0.0.0.0:*               LISTEN      -                   
tcp6       0      0 :::10300                :::*                    LISTEN      -                   
pi@raspberrypi:~/vosk-model-small-ru-0.22$ # –ü—Ä–æ–≤–µ—Ä–∏–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ –ª–æ–≥–∏
docker logs wyoming-vosk | tail -20
INFO:root:Ready
pi@raspberrypi:~/vosk-model-small-ru-0.22$

# –°–æ–∑–¥–∞–¥–∏–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –∫–æ–º–ø–æ–∑ —Ñ–∞–π–ª–æ–≤
mkdir -p /home/pi/docker
nano /home/pi/docker/docker-compose.yml

version: '3.8'

services:
  wyoming-vosk:
    image: rhasspy/wyoming-vosk:latest
    container_name: wyoming-vosk
    restart: unless-stopped
    ports:
      - "10300:10300"
    volumes:
      - /home/pi/vosk-model-small-ru-0.22:/model
    command: --data-dir /model


# –ü–µ—Ä–µ–π–¥–µ–º –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é —Å compose —Ñ–∞–π–ª–æ–º
cd /home/pi/docker

# –û—Å—Ç–∞–Ω–æ–≤–∏–º —Ç–µ–∫—É—â–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker stop wyoming-vosk
docker rm wyoming-vosk

# –ó–∞–ø—É—Å—Ç–∏–º —á–µ—Ä–µ–∑ compose
docker-compose up -d

# –ü—Ä–æ–≤–µ—Ä–∏–º —Å—Ç–∞—Ç—É—Å
docker-compose ps



# –°—Ç–∞—Ç—É—Å –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose ps

# –õ–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
docker-compose logs -f wyoming-vosk

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Ä–≤–∏—Å–∞
docker-compose stop

# –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞
docker-compose start

# –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞
docker-compose restart wyoming-vosk

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–±—Ä–∞–∑–∞ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫
docker-compose pull && docker-compose up -d
------------


### –ö—Ä–∞—Ç–∫–∞—è —à–ø–∞—Ä–≥–∞–ª–∫–∞ "–ö–∞–∫—É—é –∫–æ–º–∞–Ω–¥—É –≤—ã–±—Ä–∞—Ç—å?"

| –í–∞—à–∞ –∑–∞–¥–∞—á–∞ | –õ—É—á—à–∞—è –∫–æ–º–∞–Ω–¥–∞ |
| :--- | :--- |
| **–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –º–∞–ª–µ–Ω—å–∫–∏–π —Ñ–∞–π–ª** | 
cat file.txt |
| **–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –±–æ–ª—å—à–æ–π —Ñ–∞–π–ª / –ª–æ–≥–∏** | `less file.txt` |
| **–£–≤–∏–¥–µ—Ç—å —Ç–æ–ª—å–∫–æ –Ω–∞—á–∞–ª–æ —Ñ–∞–π–ª–∞** | `head -n 20 file.txt` |
| **–£–≤–∏–¥–µ—Ç—å —Ç–æ–ª—å–∫–æ –∫–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞ (–ª–æ–≥–∏)** | `tail -n 50 file.txt` |
| **–°–ª–µ–¥–∏—Ç—å –∑–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏ —Ñ–∞–π–ª–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏** | `tail -f /var/log/file.log` |
| **–ö—Ä–∞—Å–∏–≤—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä —Å –ø–æ–¥—Å–≤–µ—Ç–∫–æ–π** | `bat file.txt` (–ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å) |
| **–û—Ç–∫—Ä—ã—Ç—å –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (–ø—Ä–æ—Å—Ç–æ)** | `nano file.txt` |
| **–û—Ç–∫—Ä—ã—Ç—å –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (–ø—Ä–æ–¥–≤–∏–Ω—É—Ç–æ)** | `vim file.txt` |



##############################################################
# ‚è∞ –ë–£–î–ò–õ–¨–ù–ò–ö–ò
##############################################################
- id: '1758485977699'
  alias: –ë—É–¥–∏–ª—å–Ω–∏–∫ 5:50 (—É—Ç—Ä–æ, –µ—Å–ª–∏ –¥–æ–º–∞)
  triggers:
    - trigger: time
      at: "05:50:00"
  conditions:
    - condition: sun
      after: sunrise
      before: sunset
    - condition: zone
      entity_id: person.pilot
      zone: zone.zona_doma
  actions:
    - action: scene.turn_on
      target:
        entity_id: scene.outside_light
  mode: single

##############################################################
# üè† –ü–†–ò–°–£–¢–°–¢–í–ò–ï
##############################################################
- id: '1758565181246'
  alias: –õ—é–¥–∞ –Ω–µ –¥–æ–º–∞
  description: –ö–æ–≥–¥–∞ –õ—é–¥–∞ –≤—ã—Ö–æ–¥–∏—Ç –∏–∑ –¥–æ–º–∞
  use_blueprint:
    path: homeassistant/notify_leaving_zone.yaml
    input:
      person_entity: person.lydmila
      zone_entity: zone.zona_doma
      notify_device: 61dadb1c71ea3f1f584778bcf7887979

##############################################################
# üì∏ –ö–ê–ú–ï–†–´ –ò –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø
##############################################################
- id: '1758828162807'
  alias: –§–æ—Ç–æ –∫–∞–ª–∏—Ç–∫–∏ –≤ Telegram
  triggers:
    - type: changed_states
      device_id: 881625a7f60da23eaf0221b68fe29ae9
      entity_id: ebb0e68cf97d1d4f4ec9b27321928471
      domain: switch
      trigger: device
  actions:
    - action: script.outside_camera_snapshot_send
    - delay: "00:00:05"
    - action: notify.telegram
      data:
        message: "–§–æ—Ç–æ –∫–∞–ª–∏—Ç–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ üì∑"
  mode: single

- id: '1759568984689'
  alias: –§–æ—Ç–æ –ø—Ä–∏—Ö–æ–∂–µ–π –≤ Telegram
  triggers:
    - platform: state
      entity_id: sensor.mi_6525865227_message
  conditions:
    - condition: template
      value_template: >
        {{ trigger is defined
           and trigger.to_state is defined
           and trigger.to_state.state is defined
           and '–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ –¥–≤–∏–∂–µ–Ω–∏–µ' in trigger.to_state.state }}
  actions:
    - action: script.hallway_camera_snapshot_send
    - delay: "00:00:05"
    - action: notify.telegram
      data:
        message: "üì∏ –§–æ—Ç–æ –∏–∑ –ø—Ä–∏—Ö–æ–∂–µ–π –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ"
  mode: single

- id: '1761435419954'
  alias: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —Å—Ç–∞—Ç—É—Å–µ —Å–≤–µ—Ç–∞ –Ω–∞ —É–ª–∏—Ü–µ
  triggers:
    - type: changed_states
      device_id: 2332f306a04c332179cca46f72683388
      entity_id: c0e2dbf9bfc9b4acbf9c79057b25fcb1
      domain: switch
      trigger: device
  actions:
    - action: notify.telegram
      data:
        message: "üí° –°–≤–µ—Ç –Ω–∞ —É–ª–∏—Ü–µ –≤—ã–∫–ª—é—á–µ–Ω/–≤–∫–ª—é—á–µ–Ω"
  mode: single

##############################################################
# ü§ñ –ì–û–õ–û–°–û–í–´–ï –ö–û–ú–ê–ù–î–´ (WYOMING + GEMINI)
##############################################################
- id: 'wyoming_voice_processing'
  alias: –û–±—Ä–∞–±–æ—Ç–∫–∞ –≥–æ–ª–æ—Å–æ–≤—ã—Ö –∫–æ–º–∞–Ω–¥ —á–µ—Ä–µ–∑ Wyoming
  triggers:
    - platform: event
      event_type: assist_pipeline.run
  actions:
    - service: script.process_voice_command
      data:
        question: "{{ trigger.event.data.text }}"
  mode: single

- id: 'wyoming_voice_logging'
  alias: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≥–æ–ª–æ—Å–æ–≤—ã—Ö –∫–æ–º–∞–Ω–¥
  triggers:
    - platform: event
      event_type: assist_pipeline.run
  actions:
    - service: persistent_notification.create
      data:
        title: "–ì–æ–ª–æ—Å–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞"
        message: "–ü–æ–ª—É—á–µ–Ω–æ: {{ trigger.event.data.text }}"
        notification_id: "voice_command_log"
  mode: single

- id: '1759561522769'
  alias: Telegram Gemini Assistant
  description: –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π Telegram —á–µ—Ä–µ–∑ Gemini AI
  triggers:
    - platform: event
      event_type: telegram_message
  actions:
    - variables:
        user_text: "{{ trigger.event.data.text | default('') }}"
    - choose:
        - conditions:
            - condition: template
              value_template: "{{ user_text == '/start' }}"
          sequence:
            - service: notify.telegram
              data:
                message: "–ü—Ä–∏–≤–µ—Ç! –Ø –≤–∞—à AI-–ø–æ–º–æ—â–Ω–∏–∫ ü§ñ –ó–∞–¥–∞–≤–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å—ã!"
        - conditions:
            - condition: template
              value_template: "{{ user_text not in ['', '/start'] }}"
          sequence:
            - service: conversation.process
              data:
                text: "{{ user_text }}"
            - delay: "00:00:03"
            - service: notify.telegram
              data:
                message: "{{ states('conversation.last_response') | default('–ù–µ—Ç –æ—Ç–≤–µ—Ç–∞ –æ—Ç AI üòï') }}"
  mode: single

##############################################################
# üß© –û–¢–õ–ê–î–ö–ê
##############################################################
- id: 'debug_telegram_events'
  alias: Debug Telegram Events
  description: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö Telegram-—Å–æ–±—ã—Ç–∏–π –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
  triggers:
    - platform: event
      event_type: telegram_message
  actions:
    - service: persistent_notification.create
      data:
        title: "Telegram Event Debug"
        message: |
          –ü–æ–ª–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ:
          {{ trigger }}
          ---
          –¢–µ–∫—Å—Ç: {{ trigger.data.text | default('NO_TEXT') }}
          Chat ID: {{ trigger.data.chat_id | default('NO_CHAT_ID') }}
  mode: single

